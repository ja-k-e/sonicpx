!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=new AudioContext;t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cvs=document.createElement("canvas"),t&&t.appendChild(this.cvs),this.ctx=this.cvs.getContext("2d")}return a(e,[{key:"clear",value:function(){this.ctx.clearRect(0,0,this.w,this.h)}},{key:"setSize",value:function(e,t){this.w=e,this.wh=.5*e,this.h=t,this.hh=.5*t,this.cvs.width=e,this.cvs.height=t}},{key:"putImageData",value:function(e,t,n){this.ctx.putImageData(e,t,n)}},{key:"drawImage",value:function(e,t,n){this.ctx.drawImage(e,0,0)}},{key:"imageData",value:function(e,t,n,a){return this.ctx.getImageData(e,t,n,a)}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var i=function(){function e(t){var n=t.accept,a=t.handleChange,i=t.$parent;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handleChange=a,this.initDOM(n,i)}return a(e,[{key:"initDOM",value:function(e,t){var n=this;this.$container=document.createElement("div"),this.$container.className="file-upload",t.appendChild(this.$container),this.$file=document.createElement("input"),this.$file.setAttribute("type","file"),this.$file.setAttribute("accept",e),this.$container.appendChild(this.$file),this.$container.addEventListener("dragover",function(){return n.$container.classList.add("is-active")}),this.$container.addEventListener("dragleave",function(){return n.$container.classList.remove("is-active")}),this.$file.addEventListener("change",function(){if(n.$container.classList.remove("is-active"),n.$file.files&&n.$file.files[0]){var e=new FileReader;e.onload=function(e){var t=e.target;return n.handleChange(t)},e.readAsDataURL(n.$file.files[0])}})}}]),e}();t.default=i},function(e,t,n){"use strict";var a,i=n(4),r=(a=i)&&a.__esModule?a:{default:a};console.info("\n%cSonicPX v0.1\n%cÂ© Jake Albaugh "+(new Date).getFullYear()+"\nhttps://twitter.com/jake_albaugh\nhttps://github.com/jakealbaugh/sonicpx\n\n","font-family: sans-serif; font-weight: bold;","font-family: sans-serif; font-weight: normal;"),new r.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(5)),i=r(n(6));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recorder=new i.default,this.player=new a.default;var n=document.querySelector(".record"),r=!1,o=!1;n.addEventListener("click",function(){r?t.recorder.stop():t.recorder.reset();var e=(r=!r)?"add":"remove";n.classList[e]("active"),r&&!o&&(o=!0,t.recorder.initializeStream().catch(alert))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=s(n(0)),r=s(n(1)),o=s(n(2));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=new r.default(document.querySelector(".player .input")),this.file=new o.default({accept:"image/*.png",$parent:document.querySelector(".player .upload"),handleChange:this.handleFileChange.bind(this)})}return a(e,[{key:"handleFileChange",value:function(e){var t=this,n=new Image,a=e.result;n.onload=function(){return t.handleImage(a,n)},n.setAttribute("src",a)}},{key:"handleImage",value:function(e,t){this.canvas.clear(),this.canvas.setSize(t.width,t.height),this.canvas.drawImage(t,0,0),this._playImage()}},{key:"_playImage",value:function(){for(var e=this.canvas,t=(e.w,e.wh),n=e.h,a=this.canvas.imageData(0,0,t,n).data,r=this.canvas.imageData(t,0,t,n).data,o=i.default.createBuffer(2,t*n,i.default.sampleRate),s=o.getChannelData(0),c=o.getChannelData(1),u=0;u<a.length;u+=4){var l=Math.floor(u/4),f=a[u+3],h=r[u+3],d=(256*a[u+0]*256+256*a[u+1]+a[u+2])/16777216*2-1,v=(256*r[u+0]*256+256*r[u+1]+r[u+2])/16777216*2-1;f>0&&(s[l]=d),h>0&&(c[l]=v)}var p=i.default.createBufferSource(),m=i.default.createGain();m.gain.value=.95,p.connect(m),p.buffer=o,m.connect(i.default.destination),p.start()}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=s(n(0)),r=s(n(1)),o=s(n(2));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=new r.default(document.querySelector(".recorder .output")),this.file=new o.default({accept:"audio/*",$parent:document.querySelector(".recorder .upload"),handleChange:this.handleFileChange.bind(this)}),this.reset()}return a(e,[{key:"handleFileChange",value:function(e){var t=new Audio;t.setAttribute("crossorigin","anonymous"),t.src=e.result,this.initializeElement(t)}},{key:"initializeElement",value:function(e){var t=this;this.mode="element",this.reset(),e.addEventListener("canplay",function(){return t._recordElement(e)}),e.addEventListener("ended",this.stop.bind(this))}},{key:"initializeStream",value:function(){var e=this;return this.mode="stream",this.reset(),new Promise(function(t,n){navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0}).then(function(n){t(),e._recordStream(n)}).catch(n):n("getUserMedia not supported!")})}},{key:"reset",value:function(){this.off=!1,this.tick=0,this.canvas.clear(),this.canvas.setSize(2400,6400)}},{key:"stop",value:function(){this.off=!0,"stream"===this.mode&&this.redraw()}},{key:"redraw",value:function(){var e=this.lastY,t=this.canvas.imageData(0,0,this.canvas.w,e);this.canvas.clear(),this.canvas.setSize(this.canvas.w,e),this.canvas.putImageData(t,0,0)}},{key:"_recordElement",value:function(e){var t=this;this.element=e,this.input=i.default.createMediaElementSource(this.element);this.recorder=i.default.createScriptProcessor(2048,2,2);var n=Math.ceil(this.element.duration*i.default.sampleRate),a=2*Math.floor(Math.sqrt(n)),r=n/(.5*a);this.canvas.setSize(a,r),this.recorder.onaudioprocess=this._processAudio.bind(this),this.input.connect(this.recorder),this.input.connect(i.default.destination),this.element.onended=function(){t.input.disconnect(t.recorder),t.input.disconnect(i.default.destination),t.recorder.disconnect(i.default.destination),t.recorder.onaudioprocess=null},this.recorder.connect(i.default.destination),this.element.play()}},{key:"_recordStream",value:function(e){var t=this;this.input=i.default.createMediaStreamSource(e);this.recorder=i.default.createScriptProcessor(2048,2,2),this.recorder.onaudioprocess=this._processAudio.bind(this),this.input.connect(this.recorder),this.input.onended=function(){t.input.disconnect(t.recorder),t.recorder.disconnect(i.default.destination),t.recorder.onaudioprocess=null},this.recorder.connect(i.default.destination)}},{key:"_processAudio",value:function(e){if(!this.off)for(var t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),a=0;a<t.length;a++){if(this.off)return;var i=8388608*t[a]+8388608,r=8388608*n[a]+8388608,o=Math.floor(i/256/256),s=Math.floor(i-256*o*256),c=Math.floor(i-256*s),u=Math.floor(r/256/256),l=Math.floor(r-256*u*256),f=Math.floor(r-256*l),h=this.tick%this.canvas.wh,d=Math.floor(this.tick/this.canvas.wh);this.lastY=d,this.canvas.ctx.fillStyle="rgb("+o+","+s+","+c+")",this.canvas.ctx.fillRect(h,d,1,1),this.canvas.ctx.fillStyle="rgb("+u+","+l+","+f+")",this.canvas.ctx.fillRect(h+this.canvas.wh,d,1,1),this.tick++}}}]),e}();t.default=c}]);