!function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}([function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=new AudioContext;t.default=n},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cvs=document.createElement("canvas"),t&&t.appendChild(this.cvs),this.ctx=this.cvs.getContext("2d")}return n(e,[{key:"clear",value:function(){this.ctx.clearRect(0,0,this.w,this.h)}},{key:"setSize",value:function(e,t){this.w=e,this.wh=.5*e,this.h=t,this.hh=.5*t,this.cvs.width=e,this.cvs.height=t}},{key:"createImage",value:function(e,t){return this.ctx.createImageData(e,t)}},{key:"putImage",value:function(e,t,a){this.ctx.putImageData(e,t,a)}},{key:"drawImage",value:function(e,t,a){this.ctx.drawImage(e,0,0)}},{key:"imageData",value:function(e,t,a,n){return a=a||this.w,n=n||this.h,this.ctx.getImageData(e,t,a,n)}}]),e}();t.default=i},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var i=1*Math.round(32768),r=16777216,s=1*Math.round(.5*r),c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bits=t}return n(e,[{key:"toRGB",value:function(e){return 16===this.bits?this._valueToRGB16(e):24===this.bits?this._valueToRGB24(e):void 0}},{key:"_valueToRGB16",value:function(e){var t=e*i+i,a=Math.floor(t/256);return[0,a,t-256*a]}},{key:"_valueToRGB24",value:function(e){var t=e*s+s,a=Math.floor(t/256/256),n=256*a*256,i=Math.floor((t-n)/256);return[a,i,t-n-256*i]}},{key:"toValue",value:function(e,t,a){return 16===this.bits?this._normalizedValue16(e,t,a):24===this.bits?this._normalizedValue24(e,t,a):void 0}},{key:"_normalizedValue16",value:function(e,t,a){return(256*t+a)/65536*2-1}},{key:"_normalizedValue24",value:function(e,t,a){return(256*e*256+256*t+a)/r*2-1}}]),e}();t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();var i=function(){function e(t){var a=t.accept,n=t.handleChange,i=t.$parent;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handleChange=n,this.initDOM(a,i)}return n(e,[{key:"initDOM",value:function(e,t){var a=this;this.$container=document.createElement("div"),this.$container.className="file-upload",t.appendChild(this.$container),this.$file=document.createElement("input"),this.$file.setAttribute("type","file"),this.$file.setAttribute("accept",e),this.$container.appendChild(this.$file),this.$container.addEventListener("dragover",function(){return a.$container.classList.add("is-active")}),this.$container.addEventListener("dragleave",function(){return a.$container.classList.remove("is-active")}),this.$file.addEventListener("change",function(){if(a.$container.classList.remove("is-active"),a.$file.files&&a.$file.files[0]){var e=new FileReader;e.onload=function(e){var t=e.target;a.handleChange(t,a.$file.files[0]),a.$container.remove()},e.readAsDataURL(a.$file.files[0])}})}}]),e}();t.default=i},function(e,t,a){"use strict";var n,i=a(5),r=(n=i)&&n.__esModule?n:{default:n};console.info("\n%cSonicPX v0.1\n%cÂ© Jake Albaugh "+(new Date).getFullYear()+"\nhttps://twitter.com/jake_albaugh\nhttps://github.com/jakealbaugh/sonicpx\n\n","font-family: sans-serif; font-weight: bold;","font-family: sans-serif; font-weight: normal;"),new r.default},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=s(a(6)),r=s(a(7));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recorder=new r.default,this.player=new i.default,this._initDOM()}return n(e,[{key:"_initDOM",value:function(){var e=document.querySelector("nav .record"),t=document.querySelector("nav .play"),a=document.querySelector("section.recorder"),n=document.querySelector("section.player");e.addEventListener("click",function(){a.classList.add("active"),e.classList.add("active"),n.classList.remove("active"),t.classList.remove("active")}),t.addEventListener("click",function(){n.classList.add("active"),t.classList.add("active"),a.classList.remove("active"),e.classList.remove("active")})}}]),e}();t.default=c},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=o(a(0)),r=o(a(1)),s=o(a(2)),c=o(a(3));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=new r.default(document.querySelector(".player .input")),this.file=new c.default({accept:"image/*",$parent:document.querySelector(".player .upload"),handleChange:this.handleFileChange.bind(this)})}return n(e,[{key:"handleFileChange",value:function(e,t){var a=this,n=new Image,i=e.result;n.onload=function(){return a.handleImage(i,n)},n.setAttribute("src",i)}},{key:"handleImage",value:function(e,t){this.canvas.clear(),this.canvas.setSize(t.width,t.height),this.canvas.drawImage(t,0,0),this._playImage()}},{key:"_playImage",value:function(){for(var e=this.canvas,t=(e.w,e.wh),a=e.h,n=this.canvas.imageData(0,0,t,a),r=this.canvas.imageData(t,0,t,a),c=n.data,o=r.data,u=i.default.createBuffer(2,t*a,i.default.sampleRate),l=new s.default(16),h=u.getChannelData(0),f=u.getChannelData(1),d=c.length,v=0;v<d;v+=4){var m=Math.floor(v/4),p=c[v+0],g=c[v+1],y=c[v+2],b=c[v+3],w=o[v+0],k=o[v+1],_=o[v+2],D=o[v+3];255===b&&(h[m]=l.toValue(p,g,y)),255===D&&(f[m]=l.toValue(w,k,_))}var M=i.default.createBufferSource(),C=i.default.createGain();C.gain.value=.95,M.connect(C),M.buffer=u,C.connect(i.default.destination),M.start()}}]),e}();t.default=u},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=o(a(0)),r=o(a(1)),s=o(a(2)),c=o(a(3));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$parent=document.querySelector(".recorder .output"),this.file=new c.default({accept:"audio/*",$parent:document.querySelector(".recorder .upload"),handleChange:this.handleFileChange.bind(this)}),this.reset()}return n(e,[{key:"handleFileChange",value:function(e,t){var a=this,n=new Audio;n.setAttribute("crossorigin","anonymous"),n.src=e.result,n.addEventListener("canplay",function(){a.initializeElement(n)})}},{key:"initializeElement",value:function(e){this.mode="element",this.reset(),this._recordElement(e),e.addEventListener("ended",this.stop.bind(this))}},{key:"initializeStream",value:function(){var e=this;return this.mode="stream",this.reset(),new Promise(function(t,a){navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0}).then(function(a){t(),e._recordStream(a)}).catch(a):a("getUserMedia not supported!")})}},{key:"reset",value:function(){this.off=!1,this.tick=0,this.imageData=null}},{key:"stop",value:function(){this.off=!0,"stream"===this.mode&&this.redraw()}},{key:"redraw",value:function(){var e=this.lastY,t=this.canvas.imageData(0,0,this.canvas.w,e);this.canvas.clear(),this.canvas.setSize(this.canvas.w,e),this.canvas.putImageData(t,0,0)}},{key:"nextCanvas",value:function(){this.canvasesIdx++}},{key:"_recordElement",value:function(e){var t=this;this.element=e,this.input=i.default.createMediaElementSource(this.element);this.recorder=i.default.createScriptProcessor(4096,2,2),this._setCanvases(e),this.recorder.onaudioprocess=this._processAudio.bind(this),this.input.connect(this.recorder),this.input.connect(i.default.destination),this.element.onended=function(){t.canvas.putImage(t.imageData,0,0);var e=new r.default,a=t.canvases[0].w,n=t.canvases[0].h,s=t.canvases.map(function(e){return e.h}).reduce(function(e,t){return e+t});e.setSize(a,s);for(var c=0;c<t.canvases.length;c++){var o=c*n,u=t.canvases[c].imageData(0,0);e.putImage(u,0,o)}t.$parent.innerHTML="",t.$parent.appendChild(e.cvs),setTimeout(function(){alert('Download Image by right clicking and selecting "Save Image As..."')},1e3),t.input.disconnect(t.recorder),t.input.disconnect(i.default.destination),t.recorder.disconnect(i.default.destination),t.recorder.onaudioprocess=null},this.recorder.connect(i.default.destination),this.element.play()}},{key:"_setCanvases",value:function(e){var t=e.duration;this.canvasesIdx=0,this.canvases=[];for(var a=Math.ceil(t*i.default.sampleRate),n=2*Math.floor(Math.sqrt(a)),s=.5*n,c=Math.ceil(a/s),o=Math.ceil(t/5),u=Math.ceil(c/o),l=1===o?c:c-u*(o-1),h=0;h<o;h++){var f=new r.default(this.$parent),d=h===o-1?l:u;f.setSize(n,d),this.canvases.push(f)}}},{key:"_recordStream",value:function(e){var t=this;this.input=i.default.createMediaStreamSource(e);this.recorder=i.default.createScriptProcessor(4096,2,2),this.recorder.onaudioprocess=this._processAudio.bind(this),this.input.connect(this.recorder),this.input.onended=function(){t.input.disconnect(t.recorder),t.recorder.disconnect(i.default.destination),t.recorder.onaudioprocess=null},this.recorder.connect(i.default.destination)}},{key:"_processAudio",value:function(e){if(!this.off){this.imageData||(this.imageData=this.canvas.createImage(this.canvas.w,this.canvas.h));for(var t=e.inputBuffer.getChannelData(0),a=e.inputBuffer.getChannelData(1),n=new s.default(16),i=0;i<t.length;i++){if(this.off)return;var r=n.toRGB(t[i]),c=n.toRGB(a[i]),o=this.tick%this.canvas.wh,u=Math.floor(this.tick/this.canvas.wh);u!==this.lastY&&u>this.canvas.h&&(this.canvas.putImage(this.imageData,0,0),this.nextCanvas(),this.imageData=this.canvas.createImage(this.canvas.w,this.canvas.h),this.tick=0),this.lastY=u;var l=u*this.canvas.w*4+4*o,h=l+4*this.canvas.wh;this.imageData.data[l+0]=r[0],this.imageData.data[l+1]=r[1],this.imageData.data[l+2]=r[2],this.imageData.data[l+3]=255,this.imageData.data[h+0]=c[0],this.imageData.data[h+1]=c[1],this.imageData.data[h+2]=c[2],this.imageData.data[h+3]=255,this.tick++}}}},{key:"canvas",get:function(){return this.canvases[this.canvasesIdx]}}]),e}();t.default=u}]);