!function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=new AudioContext;t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cvs=document.createElement("canvas"),t&&t.appendChild(this.cvs),this.ctx=this.cvs.getContext("2d")}return a(e,[{key:"clear",value:function(){this.ctx.clearRect(0,0,this.w,this.h)}},{key:"setSize",value:function(e,t){this.w=e,this.wh=.5*e,this.h=t,this.hh=.5*t,this.cvs.width=e,this.cvs.height=t}},{key:"createImage",value:function(e,t){return this.ctx.createImageData(e,t)}},{key:"putImage",value:function(e,t,n){this.ctx.putImageData(e,t,n)}},{key:"drawImage",value:function(e,t,n){this.ctx.drawImage(e,0,0)}},{key:"imageData",value:function(e,t,n,a){return n=n||this.w,a=a||this.h,this.ctx.getImageData(e,t,n,a)}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var i=function(){function e(t){var n=t.$element,a=t.stream,i=void 0!==a&&a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.stream=i,this.$element=n,this.$play=this.$element.querySelector(".play"),this.$progress=this.$element.querySelector(".progress > span")}return a(e,[{key:"bindPlay",value:function(e){var t=this;this.$play.addEventListener("click",function n(a){a.preventDefault();a.target.removeEventListener(a.type,n,!1);t.disable();e()},!1)}},{key:"enable",value:function(){this.$element.classList.remove("disabled")}},{key:"disable",value:function(){this.$element.classList.add("disabled")}},{key:"progress",value:function(e){this.stream?"start"===e?this.$element.classList.add("streaming"):"end"===e?this.$element.classList.add("complete"):(this.$element.classList.remove("streaming"),this.$element.classList.remove("complete")):this.$progress.style.width=100*e+"%"}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(4),s=(a=r)&&a.__esModule?a:{default:a};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"bits",get:function(){return 65536}}]),t}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,[{key:"rgbStereo",value:function(e,t){return{rgbL:this.rgbMono(e).rgb,rgbR:this.rgbMono(t).rgb}}},{key:"rgbMono",value:function(e){var t=this._valToBytes(e),n=Math.floor(t/256/256);return{rgb:[n,Math.floor((t-256*n*256)/256),t%256]}}},{key:"valueStereo",value:function(e,t){return{valueL:this.valueMono(e).value,valueR:this.valueMono(t).value}}},{key:"valueMono",value:function(e){var t=256*e[0]*256+256*e[1]+e[2];return{value:this._bytesToVal(t)}}},{key:"_valToBytes",value:function(e){return e*this.bitsH+this.bitsH}},{key:"_bytesToVal",value:function(e){return e/this.bits*2-1}},{key:"bitsH",get:function(){return.5*this.bits}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(4),s=(a=r)&&a.__esModule?a:{default:a};var o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"bits",get:function(){return 16777216}}]),t}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var i=function(){function e(t){var n=t.accept,a=t.handleChange,i=t.$parent;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.handleChange=a,this.accept=n,this.$parent=i,this.initDOM()}return a(e,[{key:"disable",value:function(){this.$parent.classList.add("disabled")}},{key:"enable",value:function(){this.$parent.classList.remove("disabled")}},{key:"initDOM",value:function(){var e=this;this.$container=document.createElement("div"),this.$container.className="file-upload",this.$parent.appendChild(this.$container),this.$file=document.createElement("input"),this.$file.setAttribute("type","file"),this.$file.setAttribute("accept",this.accept),this.$file.setAttribute("required",""),this.$container.appendChild(this.$file),this.$container.addEventListener("dragover",function(){return e.$container.classList.add("is-active")}),this.$container.addEventListener("dragleave",function(){return e.$container.classList.remove("is-active")}),this.$file.addEventListener("change",function(){if(e.$parent.classList.remove("is-active"),e.$container.classList.remove("is-active"),e.$file.files&&e.$file.files[0]){var t=new FileReader,n=e.accept.replace(/\*/,""),a=e.$file.files[0];t.onload=function(t){var n=t.target;e.handleChange(n,a),e.$file.value=""},a&&a.type.match(n)?t.readAsDataURL(a):e.$file.value=""}else e.$file.value=""})}}]),e}();t.default=i},function(e,t,n){"use strict";var a,i=n(8),r=(a=i)&&a.__esModule?a:{default:a};console.info("\n%cSonicPX v0.1\n%cÂ© Jake Albaugh "+(new Date).getFullYear()+"\nhttps://twitter.com/jake_albaugh\nhttps://github.com/jakealbaugh/sonicpx\n\n","font-family: sans-serif; font-weight: bold;","font-family: sans-serif; font-weight: normal;"),new r.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(9)),i=r(n(11));function r(e){return e&&e.__esModule?e:{default:e}}t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recorder=new i.default,this.player=new a.default}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=(o(n(0)),o(n(2))),r=(o(n(1)),o(n(10))),s=o(n(6));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.audio=new i.default({$element:document.querySelector(".player .audio"),stream:!0}),this.file=new s.default({accept:"image/*",$parent:document.querySelector(".player .file"),handleChange:this.handleFileChange.bind(this)})}return a(e,[{key:"handleFileChange",value:function(e,t){var n=this;this.file.disable(),this.audio.progress("reset"),this.audio.disable(),this.converter&&this.converter.remove(),this.converter=new r.default;var a=new Image,i=e.result;a.onload=function(){n.converter.initialize(a),n.audio.enable(),n.audio.bindPlay(n.handlePlay.bind(n))},a.setAttribute("src",i)}},{key:"handlePlay",value:function(){var e=this;this.audio.progress("start"),this.converter.play(function(){return e.handleEnd()})}},{key:"handleEnd",value:function(){this.file.enable(),this.audio.progress("end")}}]),e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=u(n(0)),r=u(n(1)),s=u(n(3)),o=u(n(5));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$parent=document.querySelector(".player .input")}return a(e,[{key:"remove",value:function(){this.$parent.innerHTML="",this.source.stop(),this.source.disconnect(i.default.destination),this._playing=!1,delete this.source}},{key:"play",value:function(e){this._playing||(this.source.onended=function(){return e()},this.source.start(),this._playing=!0)}},{key:"initialize",value:function(e){this.canvas=new r.default(this.$parent),this.canvas.setSize(e.width,e.height),this.canvas.drawImage(e,0,0),this.loadMeta(),this.initializeAudio()}},{key:"loadMeta",value:function(){var e=this.canvas.imageData(0,0,4,1).data;this._hasMeta(e)?(this.version=256*e[3]+e[7],this.stereo=1===e[11],this.bits=e[15]):(this.version=65536,this.stereo=!0,this.bits=16),this.adapter=16===this.bits?new s.default:new o.default}},{key:"_hasMeta",value:function(e){var t=!0;return[0,1,2,4,5,6,8,9,10,12,13,14].forEach(function(n){0!==e[n]&&(t=!1)}),e[11]>2&&(t=!1),16!==e[15]&&24!==e[15]&&(t=!1),t}},{key:"initializeAudio",value:function(){var e=this.canvas,t=e.w,n=e.wh,a=e.h;if(this.stereo){this.buffer=i.default.createBuffer(2,n*a,i.default.sampleRate);for(var r=this.canvas.imageData(0,1,n,a-1).data,s=this.canvas.imageData(n,1,n,a-1).data,o=this.buffer.getChannelData(0),u=this.buffer.getChannelData(1),c=r.length,l=0;l<c;l+=4){var f=Math.floor(l/4),h=r[l+0],d=r[l+1],v=r[l+2],p=r[l+3],y=s[l+0],b=s[l+1],m=s[l+2],g=s[l+3],w=this.adapter.valueStereo([h,d,v],[y,b,m]),_=w.valueL,k=w.valueR;255===p&&(o[f]=_),255===g&&(u[f]=k)}}else{this.buffer=i.default.createBuffer(1,t*a,i.default.sampleRate);var $=this.canvas.imageData(0,1,t,a-1).data,M=this.buffer.getChannelData(0),O=$.length;for(l=0;l<O;l+=4){var P=Math.floor(l/4),j=$[l+0],E=$[l+1],C=$[l+2],D=$[l+3],x=this.adapter.valueMono([j,E,C]).value;255===D&&(M[P]=x)}}this.source=i.default.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(i.default.destination)}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=u(n(0)),r=u(n(2)),s=u(n(12)),o=(u(n(1)),u(n(6)));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.audio=new r.default({$element:document.querySelector(".recorder .audio")}),this.file=new o.default({accept:"audio/*",$parent:document.querySelector(".recorder .file"),handleChange:this.handleFileChange.bind(this)})}return a(e,[{key:"handleFileChange",value:function(e,t){var n=this;this.audio.progress(0),this.audio.disable(),this.file.disable(),this.element=new Audio,this.element.setAttribute("crossorigin","anonymous"),this.element.src=e.result,this.converter&&this.converter.remove(),this.audio.bindPlay(function(){n.initializeElement()}),this.element.addEventListener("canplay",function(){n.audio.enable()})}},{key:"initializeElement",value:function(){var e=this;this._recordElement(),this.element.addEventListener("ended",function(){return e.converter.stop()})}},{key:"_recordElement",value:function(){var e=this,t=document.querySelector("#stereo").checked;this.converter=new s.default({duration:this.element.duration,bits:16,stereo:t}),this.input=i.default.createMediaElementSource(this.element);var n=t?2:1;this.processor=i.default.createScriptProcessor(8192,n,n),this.processor.onaudioprocess=function(t){e.audio.progress(e.element.currentTime/e.element.duration),e.converter.process(t)},this.input.connect(this.processor),this.input.connect(i.default.destination),this.element.onended=function(){e.audio.progress(1),e.file.enable(),e.converter.handleEnd(),e.input.disconnect(e.processor),e.input.disconnect(i.default.destination),e.processor.disconnect(i.default.destination),e.processor.onaudioprocess=null,delete e.element,delete e.input,delete e.processor},this.processor.connect(i.default.destination),this.element.play()}}]),e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=u(n(0)),r=u(n(1)),s=u(n(3)),o=u(n(5));function u(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){var n=t.duration,a=t.bits,i=t.stereo,r=void 0===i||i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bits=a,this.adapter=16===a?new s.default:new o.default,this.$parent=document.querySelector(".recorder .output"),this.stereo=r,this.initialize(n),this.off=!1,this.tick=0,this.imageData=null}return a(e,[{key:"initialize",value:function(e){this.canvasesIdx=0,this.canvases=[];for(var t=Math.ceil(e*i.default.sampleRate),n=Math.floor(Math.sqrt(t)),a=this.stereo?2*n:n,s=this.stereo?.5*a:a,o=Math.ceil(t/s),u=Math.ceil(e/5),c=Math.ceil(o/u),l=1===u?o:o-c*(u-1),f=0;f<u;f++){var h=new r.default(this.$parent),d=f===u-1?l:c;h.setSize(a,d),this.canvases.push(h)}}},{key:"remove",value:function(){this.$parent.innerHTML=""}},{key:"handleEnd",value:function(){this.canvas.putImage(this.imageData,0,0);var e=new r.default,t=this.canvases[0].w,n=this.canvases[0].h,a=this.canvases.map(function(e){return e.h}).reduce(function(e,t){return e+t});e.setSize(t,a+1);var i=(new r.default).createImage(4,1);i.data[3]=Math.floor(1/256),i.data[7]=1,i.data[11]=this.stereo?1:0,i.data[15]=this.bits,e.putImage(i,0,0);for(var s=0;s<this.canvases.length;s++){var o=s*n,u=this.canvases[s].imageData(0,0);e.putImage(u,0,o+1)}this.$parent.innerHTML="",this.$parent.appendChild(e.cvs)}},{key:"stop",value:function(){this.off=!0}},{key:"process",value:function(e){if(!this.off)if(this.imageData||(this.imageData=this.canvas.createImage(this.canvas.w,this.canvas.h)),this.stereo)for(var t=e.inputBuffer.getChannelData(0),n=e.inputBuffer.getChannelData(1),a=n.length,i=0;i<a;i++){if(this.off)return;var r=this.tickPosition(),s=r.x,o=r.y*this.canvas.w*4+4*s,u=o+4*this.canvas.wh,c=this.adapter.rgbStereo(t[i],n[i]),l=c.rgbL,f=c.rgbR;this.setDataAtIndex(o,l),this.setDataAtIndex(u,f),this.tick++}else for(var h=e.inputBuffer.getChannelData(0),d=h.length,v=0;v<d;v++){if(this.off)return;var p=this.tickPosition(),y=(s=p.x,p.y*this.canvas.w*4+4*s),b=this.adapter.rgbMono(h[v]).rgb;this.setDataAtIndex(y,b),this.tick++}}},{key:"setDataAtIndex",value:function(e,t){this.imageData.data[e+0]=t[0],this.imageData.data[e+1]=t[1],this.imageData.data[e+2]=t[2],this.imageData.data[e+3]=255}},{key:"tickPosition",value:function(){var e=this.stereo?this.canvas.wh:this.canvas.w,t=this.tick%e,n=Math.floor(this.tick/e);return n!==this.lastY&&n>this.canvas.h&&(this.canvas.putImage(this.imageData,0,0),this.nextCanvas(),this.imageData=this.canvas.createImage(this.canvas.w,this.canvas.h),this.tick=0),this.lastY=n,{x:t,y:n}}},{key:"nextCanvas",value:function(){this.canvasesIdx++}},{key:"canvas",get:function(){return this.canvases[this.canvasesIdx]}}]),e}();t.default=c}]);